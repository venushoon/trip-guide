<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MBTI ìŠ¤ë§ˆíŠ¸ ì—¬í–‰ ê°€ì´ë“œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Serene Sky -->
    <!-- Application Structure Plan: The application is designed as a single-page, multi-step "wizard" to guide the user seamlessly through the process. This structure was chosen for its clarity and user-friendliness, breaking down the complex task of planning a trip into simple, manageable stages: 1. Welcome, 2. MBTI Quiz, 3. Travel Preferences, 4. Loading/Results. This linear flow minimizes user confusion, ensures all necessary data is collected before generating a recommendation, and creates an engaging, interactive experience. Each step is a distinct section that is shown or hidden via JavaScript, maintaining the single-page application feel. -->
    <!-- Visualization & Content Choices: 
        - Report Info: MBTI Analysis -> Goal: Organize/Inform -> Viz/Method: Interactive form with radio buttons and a progress bar. -> Interaction: User selects one of two options for each question. The progress bar updates dynamically. -> Justification: This is the most intuitive way to present a forced-choice questionnaire, providing clear feedback on progress. -> Library/Method: HTML/CSS/JS.
        - Report Info: Travel Preferences -> Goal: Inform/Organize -> Viz/Method: Standard form elements (text input, selects, radio groups). -> Interaction: User inputs text and selects options. -> Justification: Standard form controls are universally understood and efficient for data collection. Icons are added for visual appeal. -> Library/Method: HTML/CSS/JS.
        - Report Info: Travel Itinerary -> Goal: Inform -> Viz/Method: Dynamically generated text content within styled cards. -> Interaction: The content appears after a simulated API call. -> Justification: The output is primarily text-based. Structuring it in day-by-day cards makes the itinerary easy to read and digest. No complex visualization is needed. -> Library/Method: HTML/JS.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
        .step-transition { transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out; }
        .step-hidden { opacity: 0; transform: translateY(20px); position: absolute; pointer-events: none; }
        .step-visible { opacity: 1; transform: translateY(0); position: relative; }
        .option-card {
            border: 2px solid #e5e7eb;
            transition: all 0.2s ease-in-out;
        }
        .option-card:hover {
            border-color: #3b82f6;
            transform: translateY(-2px);
        }
        .option-card.selected {
            border-color: #3b82f6;
            background-color: #eff6ff;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .progress-bar-fill {
            transition: width 0.4s ease-in-out;
        }
        .loader {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 flex items-center justify-center min-h-screen">
    <div class="w-full max-w-2xl mx-auto bg-white rounded-2xl shadow-xl p-6 sm:p-10 my-8">
        <div class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-900">âœˆï¸ MBTI ìŠ¤ë§ˆíŠ¸ ì—¬í–‰ ê°€ì´ë“œ</h1>
            <p class="mt-3 text-gray-600">ë‹¹ì‹ ì˜ ì„±í–¥ì— ê¼­ ë§ëŠ” íŠ¹ë³„í•œ ì—¬í–‰ì„ ì¶”ì²œí•´ ë“œë¦½ë‹ˆë‹¤.</p>
        </div>

        <div id="app-container" class="relative">
            <!-- Step 1: Welcome -->
            <div id="step-1" class="step-visible step-transition">
                <div class="text-center p-4">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-4">ë‚˜ë§Œì˜ ì—¬í–‰ ìŠ¤íƒ€ì¼ ì°¾ê¸°</h2>
                    <p class="text-gray-600 mb-8">
                        ê°„ë‹¨í•œ 4ê°€ì§€ ì§ˆë¬¸ìœ¼ë¡œ ë‹¹ì‹ ì˜ MBTI ì„±í–¥ì„ íŒŒì•…í•˜ê³ ,
                        <br>ìƒìƒë§Œ í–ˆë˜ ì™„ë²½í•œ ì—¬í–‰ ê³„íšì„ ë§Œë“¤ì–´ ë³´ì„¸ìš”!
                    </p>
                    <button onclick="changeStep(2)" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg text-lg transition-transform transform hover:scale-105">
                        ì‹œì‘í•˜ê¸°
                    </button>
                </div>
            </div>

            <!-- Step 2: MBTI Quiz -->
            <div id="step-2" class="step-hidden step-transition">
                <div class="mb-6">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm font-medium text-blue-700">MBTI ë¶„ì„ ì¤‘...</span>
                        <span id="progress-text" class="text-sm font-medium text-blue-700">ì§ˆë¬¸ 1 / 4</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2.5">
                        <div id="progress-bar" class="bg-blue-600 h-2.5 rounded-full progress-bar-fill" style="width: 25%"></div>
                    </div>
                </div>

                <div id="quiz-container"></div>
                
                <div class="flex justify-between mt-8">
                    <button onclick="prevQuestion()" id="prev-btn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-6 rounded-lg transition invisible">ì´ì „</button>
                    <button onclick="nextQuestion()" id="next-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg transition invisible">ë‹¤ìŒ</button>
                </div>
            </div>

            <!-- Step 3: Travel Preferences -->
            <div id="step-3" class="step-hidden step-transition">
                <h2 class="text-2xl font-semibold text-center text-gray-800 mb-6">ì—¬í–‰ì˜ êµ¬ì²´ì ì¸ ê·¸ë¦¼ì„ ê·¸ë ¤ì£¼ì„¸ìš” ğŸ¨</h2>
                <form id="prefs-form" class="space-y-6">
                    <div>
                        <label for="destination" class="block text-sm font-medium text-gray-700 mb-1">ì–´ë””ë¡œ ë– ë‚˜ê³  ì‹¶ìœ¼ì‹ ê°€ìš”?</label>
                        <input type="text" id="destination" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="ì˜ˆ: ì œì£¼ë„, íŒŒë¦¬, ìŠ¤ìœ„ìŠ¤ ìœµí”„ë¼ìš°" required>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="duration" class="block text-sm font-medium text-gray-700 mb-1">ì—¬í–‰ ê¸°ê°„</label>
                            <select id="duration" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                                <option>1ì¼ (ë‹¹ì¼ì¹˜ê¸°)</option>
                                <option>2ì¼</option>
                                <option selected>3ì¼</option>
                                <option>4ì¼</option>
                                <option>5ì¼</option>
                                <option>6ì¼</option>
                                <option>7ì¼</option>
                            </select>
                        </div>
                         <div>
                            <label for="party-size" class="block text-sm font-medium text-gray-700 mb-1">ì¸ì› ìˆ˜</label>
                            <select id="party-size" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                                <option>1ëª…</option>
                                <option selected>2ëª…</option>
                                <option>3ëª…</option>
                                <option>4ëª…</option>
                                <option>5ëª… ì´ìƒ</option>
                            </select>
                        </div>
                    </div>

                     <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ì—¬í–‰ ìŠ¤íƒ€ì¼</label>
                        <div class="grid grid-cols-2 sm:grid-cols-3 gap-4">
                            <div><input type="radio" name="style" id="style-relax" value="íœ´ì–‘" class="sr-only" checked><label for="style-relax" class="option-card p-4 rounded-lg cursor-pointer block text-center">ğŸ–ï¸ íœ´ì–‘</label></div>
                            <div><input type="radio" name="style" id="style-couple" value="ì»¤í”Œì—¬í–‰" class="sr-only"><label for="style-couple" class="option-card p-4 rounded-lg cursor-pointer block text-center">ğŸ’ ì»¤í”Œì—¬í–‰</label></div>
                            <div><input type="radio" name="style" id="style-family" value="ê°€ì¡±ì—¬í–‰" class="sr-only"><label for="style-family" class="option-card p-4 rounded-lg cursor-pointer block text-center">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ê°€ì¡±ì—¬í–‰</label></div>
                            <div><input type="radio" name="style" id="style-activity" value="ì•¡í‹°ë¹„í‹°" class="sr-only"><label for="style-activity" class="option-card p-4 rounded-lg cursor-pointer block text-center">ğŸ„ ì•¡í‹°ë¹„í‹°</label></div>
                            <div><input type="radio" name="style" id="style-culture" value="ë¬¸í™”íƒë°©" class="sr-only"><label for="style-culture" class="option-card p-4 rounded-lg cursor-pointer block text-center">ğŸ›ï¸ ë¬¸í™”íƒë°©</label></div>
                            <div><input type="radio" name="style" id="style-food" value="ë§›ì§‘íƒë°©" class="sr-only"><label for="style-food" class="option-card p-4 rounded-lg cursor-pointer block text-center">ğŸœ ë§›ì§‘íƒë°©</label></div>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ì˜ˆì‚° ê·œëª¨ (1ì¸ë‹¹)</label>
                         <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div><input type="radio" name="budget" id="budget-1m" value="100ë§Œì›" class="sr-only" checked><label for="budget-1m" class="option-card p-4 rounded-lg cursor-pointer block text-center">ğŸ’° 100ë§Œì›</label></div>
                            <div><input type="radio" name="budget" id="budget-2m" value="200ë§Œì›" class="sr-only"><label for="budget-2m" class="option-card p-4 rounded-lg cursor-pointer block text-center">ğŸ’¸ 200ë§Œì›</label></div>
                        </div>
                    </div>

                    <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg text-lg transition-transform transform hover:scale-105">
                        ë‚˜ë§Œì˜ ì—¬í–‰ ê²½ë¡œ ì¶”ì²œë°›ê¸°
                    </button>
                </form>
            </div>

            <!-- Step 4: Loading/Result -->
            <div id="step-4" class="step-hidden step-transition">
                 <div id="loading-view" class="text-center p-8">
                    <div class="flex justify-center mb-4">
                        <div class="loader"></div>
                    </div>
                    <h2 class="text-2xl font-semibold text-gray-800">ìµœì ì˜ ì—¬í–‰ ê²½ë¡œë¥¼ ì°¾ê³  ìˆìŠµë‹ˆë‹¤...</h2>
                    <p class="text-gray-600 mt-2">Gemini AIê°€ ë‹¹ì‹ ì˜ ì„±í–¥ì„ ë¶„ì„í•˜ì—¬ ìµœê³ ì˜ ì¼ì •ì„ ë§Œë“¤ê³  ìˆì–´ìš”.</p>
                </div>

                <div id="result-view" class="hidden">
                    <div class="text-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-900">ë‹¹ì‹ ì„ ìœ„í•œ ë§ì¶¤ ì—¬í–‰ í”Œëœ!</h2>
                        <p id="result-intro" class="mt-2 text-gray-600"></p>
                    </div>
                    <div id="itinerary-container" class="space-y-4">
                        <!-- Itinerary will be injected here -->
                    </div>
                     <button onclick="restart()" class="w-full mt-8 bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-4 rounded-lg text-lg transition">
                        ë‹¤ì‹œí•˜ê¸°
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentStep = 1;
        let currentQuestionIndex = 0;
        const userAnswers = {};
        let userData = {};

        const questions = [
            {
                question: "ì£¼ë§ì— ì—ë„ˆì§€ë¥¼ ì¬ì¶©ì „í•˜ëŠ” ë‹¹ì‹ ì˜ ë°©ì‹ì€?",
                options: [
                    { text: "ì¹œêµ¬ë“¤ê³¼ ë§Œë‚˜ í™œê¸°ì°¨ê²Œ ì‹œê°„ì„ ë³´ë‚¸ë‹¤", value: "E" },
                    { text: "ì§‘ì—ì„œ ì¡°ìš©íˆ í˜¼ìë§Œì˜ ì‹œê°„ì„ ê°–ëŠ”ë‹¤", value: "I" }
                ],
                key: "EI"
            },
            {
                question: "ì—¬í–‰ ê³„íšì„ ì„¸ìš¸ ë•Œ ë‹¹ì‹ ì€?",
                options: [
                    { text: "ê³¼ê±° ê²½í—˜ê³¼ ì‹¤ì œ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ í˜„ì‹¤ì ì¸ ê³„íšì„ ì„¸ìš´ë‹¤", value: "S" },
                    { text: "ì „ì²´ì ì¸ ê·¸ë¦¼ê³¼ ê°€ëŠ¥ì„±ì„ ìƒìƒí•˜ë©° ì˜ê°ì„ ì–»ëŠ”ë‹¤", value: "N" }
                ],
                key: "SN"
            },
            {
                question: "ì¹œêµ¬ê°€ ê³ ë¯¼ì„ í„¸ì–´ë†“ì„ ë•Œ ë‹¹ì‹ ì˜ ë°˜ì‘ì€?",
                options: [
                    { text: "ê°ê´€ì ì¸ ì‚¬ì‹¤ì„ ë°”íƒ•ìœ¼ë¡œ í•´ê²°ì±…ì„ ì œì‹œí•œë‹¤", value: "T" },
                    { text: "ë”°ëœ»í•œ ê³µê°ê³¼ ìœ„ë¡œë¥¼ ë¨¼ì € ê±´ë„¨ë‹¤", value: "F" }
                ],
                key: "TF"
            },
            {
                question: "ì—¬í–‰ì§€ì— ë„ì°©í•œ ì²«ë‚ , ë‹¹ì‹ ì˜ í–‰ë™ì€?",
                options: [
                    { text: "ë¯¸ë¦¬ ì„¸ì›Œë‘” ê³„íšì— ë”°ë¼ ì²´ê³„ì ìœ¼ë¡œ ì›€ì§ì¸ë‹¤", value: "J" },
                    { text: "ì¦‰í¥ì ìœ¼ë¡œ ë§ˆìŒì´ ì´ë„ëŠ” ëŒ€ë¡œ ììœ ë¡­ê²Œ íƒí—˜í•œë‹¤", value: "P" }
                ],
                key: "JP"
            }
        ];

        function renderQuestion() {
            const quizContainer = document.getElementById('quiz-container');
            const q = questions[currentQuestionIndex];
            quizContainer.innerHTML = `
                <div class="text-center mb-8">
                    <h3 class="text-xl sm:text-2xl font-medium text-gray-800">${q.question}</h3>
                </div>
                <div class="space-y-4">
                    <div onclick="selectAnswer('${q.key}', '${q.options[0].value}', 0)" id="option-0" class="option-card p-4 sm:p-6 rounded-lg cursor-pointer text-center text-lg">
                        ${q.options[0].text}
                    </div>
                    <div onclick="selectAnswer('${q.key}', '${q.options[1].value}', 1)" id="option-1" class="option-card p-4 sm:p-6 rounded-lg cursor-pointer text-center text-lg">
                        ${q.options[1].text}
                    </div>
                </div>
            `;
            updateSelection();
            updateNavigation();
        }

        function selectAnswer(key, value, optionIndex) {
            userAnswers[key] = value;
            document.querySelectorAll('.option-card').forEach(card => card.classList.remove('selected'));
            document.getElementById(`option-${optionIndex}`).classList.add('selected');
            document.getElementById('next-btn').classList.remove('invisible');
        }

        function updateSelection() {
            const answer = userAnswers[questions[currentQuestionIndex].key];
            if (answer) {
                const q = questions[currentQuestionIndex];
                const optionIndex = q.options.findIndex(opt => opt.value === answer);
                if (optionIndex !== -1) {
                    document.getElementById(`option-${optionIndex}`).classList.add('selected');
                    document.getElementById('next-btn').classList.remove('invisible');
                }
            } else {
                 document.getElementById('next-btn').classList.add('invisible');
            }
        }
        
        function updateProgressBar() {
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            document.getElementById('progress-bar').style.width = `${progress}%`;
            document.getElementById('progress-text').innerText = `ì§ˆë¬¸ ${currentQuestionIndex + 1} / ${questions.length}`;
        }

        function updateNavigation() {
            document.getElementById('prev-btn').classList.toggle('invisible', currentQuestionIndex === 0);
            if (currentQuestionIndex === questions.length - 1) {
                document.getElementById('next-btn').innerText = 'ê²°ê³¼ í™•ì¸';
            } else {
                document.getElementById('next-btn').innerText = 'ë‹¤ìŒ';
            }
        }

        function nextQuestion() {
            if (!userAnswers[questions[currentQuestionIndex].key]) return;
            
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                renderQuestion();
                updateProgressBar();
            } else {
                calculateMBTI();
                changeStep(3);
            }
        }

        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                renderQuestion();
                updateProgressBar();
            }
        }
        
        function calculateMBTI() {
            userData.mbti = `${userAnswers.EI}${userAnswers.SN}${userAnswers.TF}${userAnswers.JP}`;
        }

        document.addEventListener('change', (e) => {
            if (e.target.name === 'style' || e.target.name === 'budget') {
                const labels = e.target.closest('.grid').querySelectorAll('label');
                labels.forEach(label => label.classList.remove('selected'));
                e.target.nextElementSibling.classList.add('selected');
            }
        });

        document.getElementById('prefs-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            userData.destination = document.getElementById('destination').value;
            userData.duration = document.getElementById('duration').value;
            userData.partySize = document.getElementById('party-size').value;
            userData.style = document.querySelector('input[name="style"]:checked').value;
            userData.budget = document.querySelector('input[name="budget"]:checked').value;
            
            changeStep(4);
            getRecommendation();
        });

        function getRecommendation() {
            document.getElementById('loading-view').classList.remove('hidden');
            document.getElementById('result-view').classList.add('hidden');

            // --- Apps Script ë°±ì—”ë“œ í•¨ìˆ˜ í˜¸ì¶œ ---
            // google.script.runì€ í´ë¼ì´ì–¸íŠ¸ ì¸¡ JavaScriptì—ì„œ Apps Script ì„œë²„ ì¸¡ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.
            // .withSuccessHandler()ëŠ” ì„œë²„ í•¨ìˆ˜ê°€ ì„±ê³µì ìœ¼ë¡œ ì‹¤í–‰ë˜ì—ˆì„ ë•Œ í˜¸ì¶œë  ì½œë°± í•¨ìˆ˜ë¥¼ ì§€ì •í•©ë‹ˆë‹¤.
            // .withFailureHandler()ëŠ” ì„œë²„ í•¨ìˆ˜ ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì„ ë•Œ í˜¸ì¶œë  ì½œë°± í•¨ìˆ˜ë¥¼ ì§€ì •í•©ë‹ˆë‹¤.
            google.script.run
                .withSuccessHandler(showResult)
                .withFailureHandler(showError)
                .getTravelRecommendation(userData); // userData ê°ì²´ë¥¼ Apps Script í•¨ìˆ˜ë¡œ ì „ë‹¬
        }

        function showResult(result) {
            document.getElementById('loading-view').classList.add('hidden');
            document.getElementById('result-view').classList.remove('hidden');
            
            document.getElementById('result-intro').innerText = `${userData.mbti} ì„±í–¥ì˜ ë‹¹ì‹ ì—ê²Œ ë”± ë§ëŠ” ${userData.destination} ${userData.duration} ì—¬í–‰!`;
            
            const itineraryContainer = document.getElementById('itinerary-container');
            itineraryContainer.innerHTML = '';
            
            result.itinerary.forEach((day, index) => {
                const dayElement = document.createElement('div');
                dayElement.className = 'bg-gray-100 p-4 rounded-lg';
                dayElement.innerHTML = `
                    <h3 class="font-bold text-lg text-blue-700">Day ${index + 1}: ${day.theme}</h3>
                    <ul class="mt-2 list-disc list-inside text-gray-700 space-y-1">
                        ${day.activities.map(activity => `
                            <li>
                                ${activity.name}
                                ${activity.mapLink ? `<a href="${activity.mapLink}" target="_blank" class="ml-2 text-blue-500 hover:text-blue-700 text-sm">ğŸŒ ì§€ë„ ë³´ê¸°</a>` : ''}
                            </li>
                        `).join('')}
                    </ul>
                    <p class="text-sm text-gray-500 mt-3">âœ¨ <span class="font-semibold">Tip:</span> ${day.tip}</p>
                `;
                itineraryContainer.appendChild(dayElement);
            });

            // ì¶”ì²œ ê²°ê³¼ë¥¼ Google Sheetì— ì €ì¥
            const dataToSave = {
                mbti: userData.mbti,
                destination: userData.destination,
                duration: userData.duration,
                partySize: userData.partySize,
                style: userData.style,
                budget: userData.budget,
                itinerary: JSON.stringify(result.itinerary) // ê°ì²´ë¥¼ JSON ë¬¸ìì—´ë¡œ ë³€í™˜í•˜ì—¬ ì €ì¥
            };
            google.script.run
                .withFailureHandler(showError) // ì €ì¥ ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ì²˜ë¦¬
                .saveToSheet(dataToSave);
        }

        function showError(error) {
            // ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ì‚¬ìš©ìì—ê²Œ í‘œì‹œí•˜ëŠ” ë¡œì§ (ì˜ˆ: ëª¨ë‹¬ íŒì—…, ê²½ê³  ë©”ì‹œì§€ ë“±)
            // alert() ëŒ€ì‹  ì»¤ìŠ¤í…€ ëª¨ë‹¬ì´ë‚˜ divì— ë©”ì‹œì§€ë¥¼ í‘œì‹œí•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.
            console.error('Apps Script ì˜¤ë¥˜:', error);
            document.getElementById('loading-view').classList.add('hidden'); // ë¡œë”© í™”ë©´ ìˆ¨ê¸°ê¸°
            const appContainer = document.getElementById('app-container');
            let errorDiv = document.getElementById('error-message');
            if (!errorDiv) {
                errorDiv = document.createElement('div');
                errorDiv.id = 'error-message';
                errorDiv.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                errorDiv.innerHTML = `
                    <div class="bg-white p-6 rounded-lg shadow-lg text-center">
                        <h3 class="text-xl font-bold text-red-600 mb-4">ì˜¤ë¥˜ ë°œìƒ!</h3>
                        <p class="text-gray-700 mb-4">${error.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'}</p>
                        <button onclick="document.getElementById('error-message').remove()" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded">í™•ì¸</button>
                    </div>
                `;
                document.body.appendChild(errorDiv);
            } else {
                errorDiv.querySelector('p').innerText = error.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
                errorDiv.style.display = 'flex';
            }
        }
        
        function changeStep(targetStep) {
            const currentEl = document.getElementById(`step-${currentStep}`);
            const targetEl = document.getElementById(`step-${targetStep}`);

            currentEl.classList.add('step-hidden');
            currentEl.classList.remove('step-visible');

            targetEl.classList.remove('step-hidden');
            targetEl.classList.add('step-visible');
            
            currentStep = targetStep;
        }

        function restart() {
            currentQuestionIndex = 0;
            for(const key in userAnswers) { delete userAnswers[key]; }
            userData = {};
            document.getElementById('prefs-form').reset();

            // ë¼ë””ì˜¤ ë²„íŠ¼ ì„ íƒ ì´ˆê¸°í™”
            document.querySelectorAll('.option-card.selected').forEach(el => el.classList.remove('selected'));
            document.querySelector('label[for="style-relax"]').classList.add('selected'); // íœ´ì–‘ ê¸°ë³¸ ì„ íƒ
            document.querySelector('label[for="budget-1m"]').classList.add('selected'); // 100ë§Œì› ê¸°ë³¸ ì„ íƒ

            changeStep(1);
            setTimeout(() => {
                renderQuestion();
                updateProgressBar();
            }, 500);
        }

        // Initial render
        window.onload = () => {
            renderQuestion();
            // ì´ˆê¸° ë¡œë“œ ì‹œ ê¸°ë³¸ ì„ íƒëœ ë¼ë””ì˜¤ ë²„íŠ¼ì˜ UIë¥¼ ì—…ë°ì´íŠ¸
            document.querySelector('label[for="style-relax"]').classList.add('selected');
            document.querySelector('label[for="budget-1m"]').classList.add('selected');
        };

    </script>
</body>
</html>
